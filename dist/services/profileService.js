import { environment } from '../environment';
import axiosInstance from './axiosConfig';
class ProfileService {
    constructor() {
        this.apiUrl = `${environment.apiUrl}/api/Profile`;
    }
    async create(profile) {
        try {
            console.log("profile", profile);
            const response = await axiosInstance.post(`${this.apiUrl}/`, profile);
            console.log('Profile creation response:', response);
            if (!response.data) {
                throw new Error('No profile ID returned from server');
            }
            return response.data;
        }
        catch (error) {
            console.error('Error creating profile:', {
                error: error,
                response: error.response?.data,
                status: error.response?.status,
                fullError: error.message
            });
            throw error;
        }
    }
    async createClientProfile(clientData) {
        try {
            // Convert the client data to the full profile format
            const profile = {
                id: '', // Will be generated by the server
                image: null,
                name: `${clientData.firstName} ${clientData.lastName}`,
                dateOfBirth: null,
                gender: null,
                location: null,
                email: clientData.email,
                phoneNumber: clientData.tel,
                userType: UserType.Client,
                about: null,
                qualifications: null,
                specialisms: null,
                gyms: null,
                newPassword: null,
                userId: clientData.userId,
                height: null,
                weight: null,
                bmi: null
            };
            console.log("Creating client profile:", profile);
            const response = await axiosInstance.post(`${this.apiUrl}/`, profile);
            console.log('Client profile creation response:', response);
            if (!response.data) {
                throw new Error('No profile ID returned from server');
            }
            return response.data;
        }
        catch (error) {
            console.error('Error creating client profile:', {
                error: error,
                response: error.response?.data,
                status: error.response?.status,
                fullError: error.message
            });
            throw error;
        }
    }
    async update(id, profile) {
        try {
            await axiosInstance.put(`${this.apiUrl}/${id}`, profile);
        }
        catch (error) {
            console.error('Error updating profile:', error.response?.data || error.message);
            throw error;
        }
    }
    async updateExtendedInfo(userId, extendedInfo) {
        try {
            // First get the current profile
            const currentProfile = await this.getByUserId(userId);
            if (!currentProfile) {
                throw new Error('Profile not found');
            }
            // Update the profile with extended information
            const updatedProfile = {
                ...currentProfile,
                height: extendedInfo.height,
                weight: extendedInfo.weight,
                gender: extendedInfo.gender || currentProfile.gender,
                bmi: null // Will be calculated by the API
            };
            await this.update(currentProfile.id, updatedProfile);
        }
        catch (error) {
            console.error('Error updating extended profile info:', error.response?.data || error.message);
            throw error;
        }
    }
    async getAll() {
        try {
            const response = await axiosInstance.get(`${this.apiUrl}/`);
            return response.data;
        }
        catch (error) {
            console.error('Login failed:', error.response?.data || error.message);
            return [];
        }
    }
    async getById(id) {
        try {
            const response = await axiosInstance.get(`${this.apiUrl}/${id}`);
            console.log("response", response.data);
            return response.data;
        }
        catch (error) {
            console.error('Error fetching profile:', error.response?.data || error.message);
            return null;
        }
    }
    async getByUserId(id) {
        try {
            const response = await axiosInstance.get(`${this.apiUrl}/user/${id}`);
            return response.data;
        }
        catch (error) {
            console.error('Error fetching profile:', error.response?.data || error.message);
            return null;
        }
    }
    async getExternalClients() {
        try {
            // First get all clients
            const clients = await this.getAll();
            // Then filter out the clients that are not external
            const externalClients = clients.filter((client) => client.userType === UserType.ExternalClient);
            return externalClients;
        }
        catch (error) {
            console.error('Error fetching external clients:', error.response?.data || error.message);
            return [];
        }
    }
}
export default new ProfileService();
export var UserType;
(function (UserType) {
    UserType[UserType["Admin"] = 0] = "Admin";
    UserType[UserType["Trainer"] = 1] = "Trainer";
    UserType[UserType["Client"] = 2] = "Client";
    UserType[UserType["ExternalClient"] = 3] = "ExternalClient";
})(UserType || (UserType = {}));
